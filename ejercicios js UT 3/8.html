<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Ejericio 8</title>

        <script>
            

            fecha = pedirFecha() //Esta función hace lo que hicimos en el ejercicio 5.
            
            //las validaciones se hacen en la función, ya está garantizado que fecha va a ser una fecha, así que
            //puedo convertirla a un objeto de la clase Date sin hacer ninguna comprobación adicional.  

            fechaFormateada = new Date(convertirFecha(fecha)) //convertirFecha pasa de formato dd-mm-aaaa a mm-dd-aaaa que es el que usa javascript

            
            
            mes = 2592000000 //este es el número de milisegundos que pasan en 30 días.


            
            milisegundos = fechaFormateada.getTime() + mes

            milisegundos2 = fechaFormateada.getTime() + mes*2
            
            milisegundos3 = fechaFormateada.getTime() + mes*3
            
            
            document.write("Fecha introducida: " + mostrarFecha(fechaFormateada) + "<br><br>")
            document.write("En 30 días será: " + mostrarFecha(milisegundos) + "<br>")
            document.write("En 60 días será: " + mostrarFecha(milisegundos2) + "<br>")
            document.write("En 90 días será: " + mostrarFecha(milisegundos3) + "<br>")

            


            function pedirFecha(){
                
                //he reutilizado todo el código del ejercicio 5

                const rex = /^[0-9]{2}[-/.]{1}[0-9]{2}[-/.]{1}[0-9]{4}$/
                fechaValida=false


                while(!fechaValida){
                    fecha = prompt("Escriba una fecha.")
                

                    if(rex.test(fecha)){

                        array = fecha.split(/[./-]/) // hago un split cuando encuentre un . una barra o un guión.

                            if(array[0] > 31 || array[1] > 12){
                                // el día no puede ser mayor a 31, ni el mes a 12
                                alert("Debe escribir una fecha válida.")
                            }
                            else{
                                fechaValida=true //detenemos el bucle, ya tenemos un input válido.
                                fecha = array[0] + "/" + array[1] + "/" + array[2];
                            
                            }

                    }

                    else{
                        alert("Debe escribir una fecha válida.")
                    }
                }

                return fecha;
            }
                
            function mostrarFecha(milisegundos){
                //esta función también la he copiado, pero del ejercicio 6
                //la he tenido que adaptar un poco :S

                fecha = new Date(milisegundos)

                day = fecha.getDate();
                month = fecha.getMonth();    
                year = fecha.getFullYear();
                //lo pongo en inglés porque no quiero poner una ñ en año ni escribir ano.
                meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]

                return (day + " de " + meses[month] + " de " + year);
            }
                   
            function convertirFecha(fecha){
                /*
                Esta función transforma el output de la función pedirFecha() en formato mm-dd-aaaa.
                La función pedirFecha solo te la da por válida si cumple el formato dd-mm-aaaa, que es el formato español,
                pero javascript trabaja con mm-dd-aaaa, que es el inglés o americano, en realidad no se de donde es, pero eso, que es mm-dd-aaaa
                y no dd-mm-aaaa, asi que si le pasas por ejemplo 30/10/2020, va a explotar porque cree que el 30 es mes.
                */

                //fecha = array[0] + "/" + array[1] + "/" + array[2]; ---> así te da la fecha la función pedirFecha(), pero debemos darle la vuelta.


                arrayDatos = fecha.split("/")

                fechaFormateada = array[1] + "/" + array[0] + "/" + array[2];

                return fechaFormateada
            }
        
        </script>

    </head>

    <body>

    </body>

</html>